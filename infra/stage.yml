services:
  postgres:
    env_file: env/stage.env
    volumes:
      - /mnt/HC_Volume_102520323/loylvolume/pgdata-stage:/var/lib/postgresql/data
    networks: [tnet-stage]
    depends_on: [redis]
  redis:
    env_file: env/prod.env
    networks: [tnet-stage] 
  landing:
    image: edvin3i/loyelto-landing:stage
    labels:
      - traefik.enable=true
      - traefik.http.routers.landing-stage.rule=Host(`stage.loyel.to`)
      - traefik.http.routers.landing-stage.entrypoints=websecure
      - traefik.http.routers.landing-stage.tls.certresolver=le
      - traefik.http.services.landing-stage.loadbalancer.server.port=80
    networks: [tnet-stage]
  fastapi:
    image: edvin3i/loyelto-fastapi:stage
    env_file: env/stage.env
    labels:
      - traefik.enable=true
      - traefik.http.routers.fastapi-stage.rule=Host(`api.stage.loyel.to`)
      - traefik.http.routers.fastapi-stage.entrypoints=websecure
      - traefik.http.routers.fastapi-stage.tls.certresolver=le
      - traefik.http.services.fastapi-stage.loadbalancer.server.port=8000
    depends_on: [postgres, redis]
    networks: [tnet-stage]
